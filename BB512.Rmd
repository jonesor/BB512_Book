--- 
title: "BB512 - Population Biology and Evolution"
author: "Owen R. Jones (Course Coordinator)"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
pandoc_args: --listings
output:
  bookdown::gitbook:
    config:
      toc:
        collapse: section
    includes:
      in_header: extras.css
  bookdown::pdf_book:
    includes:
      in_header: preamble.tex
    papersize: a4
  pdf_document:
    includes:
      in_header: preamble.tex
classoption: a4paper
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
description: "Course book for BB512 at the Biology Department, University of Southern Denmark"

---
```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```

```{r setOptions, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE, message = FALSE, options(scipen = NULL)
)
```

# Welcome to BB512


Welcome to the Population and Evolution course. 
The course is divided into two parts: Population and Evolution. 

The population part comes first and covers ecological population dynamics including models of population growth, species interactions, and other demographic models. 

The recommended textbook is:
Gotelli, NJ (2008) *A Primer of Ecology*. Fourth Edition, Sinauer Associates. ISBN: 978-0878933181

The evolution part comes second and covers microevolutionary processes (natural selection, neutral evolution etc.), population and quantitative genetics, and macroevolution (speciation, extinction and coevolution). 

The recommended textbook is: 
Stearns, SC & Hoekstra, RF (2005) *Evolution: An Introduction*. 2nd Edition, Oxford University Press. ISBN: 978-0199255634

## This website and other course materials

This website is designed to hold most of the materials you need for the practical (mainly computer) exercises you will do during the course. You will also find the [Schedule](https://jonesor.github.io/BB512_Book/schedule.html) here.

You will find other materials via itsLearning. Apart from the book, there will be some recommended scientific papers to read – these will be accessible via links on itsLearning.

In some of the classes there will be exercises conducted on your personal laptops. Please bring them to class (and remember a power supply!).

## Expectations

There are lectures and exercise sessions on the course. The exercise sessions are designed to help you understand the subject better and I expect students to attend and actively participate in both. There will also be some e-tests throughout the semester. These are intended to help you figure out whether you know the material, and whether there are areas you need to revisit. They do not contribute to your final grade, but I hope you will attempt them. They will definitely increase your understanding of the material! Note that the final assessment will be a similar format!

I also expect students to make every effort to keep up with the core reading (mainly the textbook chapters), and to ask questions where they don’t understand.

## Your feedback

I would really like your feedback on how the course is progressing so I can address any issues that come up as soon as possible. To help with this I have created a simple Google Form: http://goo.gl/gy2Q6B. You can use this to send me (Owen) comments (anonymously if you wish) at any time in the course. I promise to do my best to resolve any problems.
 
## Assessment

The assessment for the course will be an electronic exam held next January with multiple choice and short answer questions. It is worth noting that exam format will be similar to the quizzes mentioned above. The exact date is not yet set.


## Instructors

The instructors of the course are:

*	[Owen Jones](https://portal.findresearcher.sdu.dk/en/persons/jones), Associate Professor, jones@biology.sdu.dk 
*	[Thomas Bjørneboe Berg](https://portal.findresearcher.sdu.dk/en/persons/thomasbb), Associate Prof./Senior Scientist at Naturama, thomas@naturama.dk  

Finally, if you have any problems accessing materials, or have any questions regarding the course feel free to send me an email, or make a comment in the form I mentioned above. You can also make an appointment to see me via Zoom or in my office if necessary*.

Owen Jones, course coordinator - [jones@biology.sdu.dk](mailto:jones@biology.sdu.dk ) 

Office location: [V12-410b-2](https://clients.mapsindoors.com/sdu/573f26e4bc1f571b08094312/details/563cb94f423b7d0540c9a605)

```{block, type="do-something"}
**Note:** The website is an experimental "work in progress" and will change during the course as I add material. The latest version can always be found at the website.

Please let me know ([jones@biology.sdu.dk](mailto:jones@biology.sdu.dk)) if you spot any errors, or have any suggestions for improvement.
```


<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Schedule

This is the schedule for the course. 
Please note that it is liable to change (possibly at short notice). 
If you find a mismatch between this schedule and the official one^[https://mitsdu.sdu.dk/skema/activity/N100007101/e21], then it is the official one that is correct.

The *Textbook* column tells you the chapter(s) of the two textbooks that are most relevant to the session. The two textbooks are Gotelli (G)^[
Gotelli, NJ (2008) *A Primer of Ecology*. Fourth Edition, Sinauer Associates. ISBN: 978-0878933181] and Stearns and Hoekstra (SH)^[Stearns, SC & Hoekstra, RF (2005) *Evolution: An Introduction*. 2nd Edition, Oxford University Press. ISBN: 978-0199255634], and the numbers refer to the chapter numbers (e.g. SH.3, means Chapter 3 in Stearns and Hoekstra).

You should aim to read these chapters as the course proceeds.

```{r, echo = FALSE, include=knitr::is_latex_output()}
plot(1,1,type = "n",axes = FALSE,xlab="",ylab="")
text(1,1,labels = "The schedule is only available on the HTML version of this document")
```


```{r, echo = FALSE, message=FALSE,warning=FALSE,eval=knitr::is_html_output()}
library(flextable)
library(readxl)

system("cp -r ~/Dropbox/_SDU_Teaching/BB512/'Course Documents'/BB512_Schedule.xlsx ~/Dropbox/_SDU_Teaching/BB512/BB512_Book/BB512_Schedule.xlsx")
schedule <- readxl::read_excel("BB512_Schedule.xlsx")
```

```{r, echo = FALSE, message=FALSE,warning=FALSE, results = 'hide'}
# Clean up old ics files
ics_files <- list.files(pattern = "*.ics")
file.remove(ics_files)

library(lubridate)
library(calendar)
library(magrittr)
library(dplyr)
curl::curl_download("https://mitsdu.sdu.dk/skema/icalendar/activities/N100007101/e21/e21",destfile = "bb512.ics")

#Last sunday in October, 0300, CEST -> CET, 
#So the time offset moves from +2 to +1

savingsTimeSwitch <- with_tz(lubridate::as_datetime("2021-10-31 03:00:00"), "Europe/Copenhagen")

courseCal <- ic_read("bb512.ics") %>% 
  arrange(DTSTART) %>% 
  mutate(Session = row_number()) %>% 
  mutate(savingsT = DTSTART < savingsTimeSwitch) %>% 
  mutate(offsetT = if_else(savingsT == TRUE, 2, 1)) %>% #Check this every year!
  mutate(DTSTART2 = DTSTART + hours(offsetT)) %>% 
  mutate(DTEND2 = DTEND + hours(offsetT)) %>% 
  mutate(St = hour(DTSTART2)) %>% 
  mutate(En = hour(DTEND2)) %>% 
  mutate(wd = lubridate::wday(DTSTART2,label= TRUE)) %>% 
  mutate(Room = gsub(pattern = "Odense ",replacement = "", x = LOCATION)) %>% 
  mutate(Room = paste0("(",Room,")")) %>% 
  mutate(Date = paste0( month(DTSTART2,label = TRUE)," ",day(DTSTART2),", ",wd)) %>% 
  mutate(Time = paste0("kl.",St,"-",En)) %>% 
  select(Session,Date, Time, Room)

schedule <- readxl::read_excel("BB512_Schedule.xlsx")

schedule <- left_join(courseCal,schedule)
```



```{r, echo = FALSE, message=FALSE,eval=knitr::is_html_output(), warning=FALSE}
library(lubridate)
library(officer)

schedule2 <- schedule %>% 
  select(Part, Date, Time, Room, Session, Type, Topic, Instructor, Textbook)

big_b <- fp_border(color="gray70", width = 3)
std_b <- fp_border(color="gray70", style = "dashed")
big_b_end <- fp_border(color="white", width = 3)

ft <- flextable(schedule2, cwidth = c(2,9,4,1,.5,1,4,.75,.75)) %>% 
  bold(part = "header") %>% 
  bold(j = 1) %>% 
  color(i = ~ Type == "Lecture",
         j = ~  Session  + Type + Topic,
        color="red") %>% 
  merge_v(j = ~ Date + Part ) %>% 
  fontsize(part = "all", size = 14) %>% 
  vline(border = std_b, j = 1:4) %>% 
  rotate(j = ~ Part, align = 'top', rotation = 'tblr') %>% 
  hline(border = std_b ,i = seq(2,nrow(schedule2),2)) %>% 
  hline(border = big_b_end ,i =nrow(schedule2))

  
ft
```

```{r, echo =FALSE,message=FALSE,warning=FALSE}
source("personalCalendar.R")
```


<!--chapter:end:0_001-Schedule.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# (PART) Population Biology {-}

<!--chapter:end:1_00.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# The legend of Ambalapuzha

Exponential growth is a powerful concept. To help us grasp it better lets use an ancient Indian chess legend as an example.

```{r,out.width="50%",fig.align='center',echo = FALSE}
knitr::include_graphics('images/Radha-Krishna_chess.jpg')
```


According to legend, Lord Krishna once appeared in the form of a wise man in the court of the king and challenged him to a game of chess. The king was a chess enthusiast and naturally accepted the invitation.

The king asked the wise man to choose a prize in case he won. The old man told the king that he had few material needs and that all he wished was a few grains of rice.

He added that the amount of rice itself should be determined using the chess- board in the following manner: one grain of rice would be placed in the first square, two grains in the second square, four in the third square, and so on. Every square would have double the number of grains of its predecessor.

Upon hearing this, the king was unhappy, since the man requested only a few grains of rice instead of any of the other riches of the kingdom, which the king would have been happy to donate (he was a generous guy). He requested the old man to add other items to his prize, but the man declined.

So the game of chess started and, needless to say, the king lost the game so it was soon time to pay the old man his prize. As he started adding grains of rice to the chessboard, the king soon realised the true nature of the wise man's demand. The royal granary soon ran out of rice and the king realised that even if he provided all the rice in his kingdom and even the whole of India, he would never be able to fulfill the promised reward. He was distraught that he could not fulfill his promise!

Seeing the king upset, the wise man appeared to the king in his true form, that of Lord Krishna. He told the king that he did not have to pay the debt immediately but could pay him over time. The king would serve rice in the temple freely to the pilgrims every day until the debt was paid off. And that is why the Ambalappuzha Temple in India still serves rice to pilgrims – the debt is still being paid off.


```{block, type="do-something"}
Use the Excel sheet (`[RiceOnAChessboard.xlsx](https://www.dropbox.com/s/nf81t0hzz34vyzk/RiceOnAChessboard.xlsx?dl=1)`) to calculate the quantity of rice that the king owed.

A grain of rice weighs 25mg, what weight of rice did the king owe in total, in kg?
```

## Animals/plants, not grains of rice.

Imagine that instead of rice, we were talking about the population growth of bacteria, or rabbits, reproducing every time step.

<!--
```{block, type="do-something"}
We have about 100 breeding pairs of great tits (musvit) in the woodland around SDU. A female lays an average of 6 eggs per year with a 50:50 sex ratio.
Assuming 100% survival, how many females would we have after 5 years?
```
-->

* Would the model be realistic?
* Why/why not?
* What other factors should be taken into account?



## Optional: Try these calculations in R

You can do this kind of calculation easily in *R*. Try this.

```{r}
myData <- data.frame(Squares = 1:64,nRice = NA)
myData$nRice[1] <- 1 

for (i in 2:64){
  myData$nRice[i] <- myData$nRice[i-1]*2
}
```

Now we can look at the top and bottom of the 64 row data frame like this:

```{r}
head(myData)
tail(myData)
```

And we can sum up the total number of grains of rice on the 64 squares of the board like this:

```{r}
sum(myData$nRice)
```

To put that *HUGE* number in context, if a grain of rice ways 25mg (0.0000025kg), then we'd have `r format(0.0000025*sum(myData$nRice),big.mark = ",", scientific=FALSE)` kg.


<!--chapter:end:1_01_Ambalapuzha.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Geometric growth

In a simple model of population growth where the population grows without any constraints, the speed a population increases in size can be described by the population growth rate. This is often given by the symbol lambda ($\lambda$). High values of $\lambda$ mean the population grows fast, while small values indicated that it grows slowly, or shrinks in size.

Geometric growth is often seen as synonymous to exponential growth. It basically is, but with one important difference: exponential growth, strictly speaking, refers to “continuous time” scenarios, whereas geometric growth refers to models where the population changes in discrete time steps (e.g. each year).

Download and open the Excel file [`GeometricGrowth.xlsx`](https://www.dropbox.com/s/xxx05sckvop5i52/GeometricGrowth.xlsx?dl=1).

1.	Starting with an initial population size (`N`) of 10 [at time (`t`) =0], and with a $\lambda$ of `1.1`, use Excel’s equation functions to work out the population size from `t=1` through to `t=20`. E.g. The formula might look something like this “`=B8*$F$8`”.
2.	Use charts to plot the results. On the horizontal axis (x-axis) you should have time, and on the vertical axis (y-axis) you should have population size (`N`). A scatterplot would be best for this.
3.	Make another plot of the same data, but this time use a natural logarithmic axis for the population size. The formula in Excel for natural log is `LN()`.
4.	What do you notice about the curves in these different versions of plotting the same data?
5.	Try altering the population growth rate. Try values of 0.8, 1 and 1.2 for example. What happens to the curves? What is special about the value of 1?


Now reset the population growth rate to 1.1. Now lets see if the mathematical rules of so-called “geometric series” work...

1.	If the population starts at t=0, $N_t = N_0 \lambda^t$ . In words, the population at time $t$ is the initial population size multiplied by the finite population growth rate raised to the power of $t$.
2.	Your instructor will explain how this works on the blackboard.
3.	Following these rules, the population size at time $t=5$ ($N_5$), is $10 * 1.1^5$, or $10* 1.61051$, which is $16.1051$. Check that this matches what you got earlier.
4.	This approach can be really useful because it can save lots of time. For example, what is the population after 900 generations? It would be tedious to work this out using the first, "simple" approach, but very easy if you use the geometric series rules.



<!--chapter:end:1_02_GeometricGrowth.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Stochastic population growth

```{r echo = FALSE}
set.seed(134)
```


We will examine the effect of adding stochasticity (randomness) into the simple exponential/geometric growth model you have been looking at in the last couple of lectures. Remember – this model allows for unbounded population growth – the populations development is not influenced by population density.

We'll focus on the discrete form:  $N_{t+1}=λN_t$  ^[Equation 1.15 in Gotelli]

In many cases it is unlikely that the finite rate of increase ($λ$) will be constant through time. Population growth rates are likely to vary through time because of environmental factors (weather, food supply etc.). This is called *environmental stochasticity*.

We will create some models in Excel, and in R, to explore the effect that this variation has.

A good way to begin thinking about this topic is to consider that the instantaneous rate of increase  ($r$) of the population can vary. We can simulate this by drawing a random number drawn from a normal distribution with a mean ($\bar{r}$) and variance ($\sigma_r^2$) (Fig. \@ref(fig:stochGrowthRate)). In the figure you can see that the peak of the $r$ distribution is $>0$ (approximately 0.1), so on average, the population will tend to grow.  However, in poor years $r$ is $<$ 0, so the population will decline in those cases. Both the mean value and the spread of the distribution (i.e. variance or standard deviation) determine the fate of the population. 
We can convert $r$ to  $\lambda$ by taking the exponential, because $r = ln(\lambda)$^[equation 1.5 in Gotelli]


```{r stochGrowthRate, echo=FALSE,fig.width=6,fig.height=4,fig.align='center',fig.cap="A normal distribution of potential r values"}
set.seed(123)
pgr <- data.frame(r = rnorm(1000,0,0.25))
ggplot(pgr,aes(x=r))+geom_histogram(bins =30) +
  theme_minimal()
```

When using the equation above to calculate population at time $t+1$ ($N_{t+1}$) from the population at time $t$ ($N_t$), one would draw a random $r$ value from this distribution. Sometimes $r$ will be high, other times it will be low, most of the time it will be from around the middle of the distribution.


```{block, type="do-something"}
Use the Excel worksheet,  `[StochasticPopulationGrowth.xslx](https://www.dropbox.com/s/1wpixbpgwlh54f0/StochasticPopulationGrowth.xlsx?dl=1)`,  to study how stochastic population growth works with this simple model.
```


1)	Use Excel formulae to calculate deterministic population size through time (20 generations, with starting population of 100), linking to the mean finite population growth rate.
2)	Use charts to plot the results. (you already did this last time!)
3)	Use a formula to generate a column of stochastic $r$ values, based on a particlar mean and variance. [English Excel: `=NORMINV(RAND(),$F$10,SQRT($F$11))`/ Danish Excel: `=NORMINV(SLUMP();$F$10;KVROD($F$11))`. If you get errors, check whether Excel is expecting commas or semi-colons]
4)	Use the same procedure as before, to create a stochastic population size vector (stochastic N). Remember to convert $r$ to $\lambda$ by taking the exponential.
5)	Compare the two trajectories using a chart.
6)	Try altering initial population size, the mean finite growth rate, and the amount of stochasticity (Variance).
7)	Extinction occurs when N $\leq$ 0. What happens to extinction risk as stochasticity increases? What hapens when initial N is small?

```{block, type="do-something"}
Note: Excel re-randomises the random numbers every time you change any cell in the sheet. This is OK, and allows you to explore a stochastic simulation many times.
```

## Simulations in R

Excel is of limited use to really get a feel for this. For the next part we'll use *R*.

If you already have R on your computers you can play along, otherwise take a look at my demonstration in class. I will show how you can use this simulation approach to estimate extinction risk and how this is related to starting population size, mean lambda, and the amount of stochasticity.

You can copy/paste the code below into *R*.

The output of the modelling is shown in  Fig. \@ref(fig:stochProjection)

```{block, type="do-something"}
Copy-and-paste the code below into a text file (or directly into *R*).

The final line of the code (`nExtinct/nTrials`) gives you an estimate of extinction probability - the proportion of trials that lead to a population size of 1 (or less).

Modify the simulation settings to explore what happens to (i) the plot of population growth and (ii) extinction risk, when you vary  `mean.r` ($\bar{r}$), the amount of stochasticity ($\sigma_r^2$) (`var.r`), and the number of generations (`nGen`).
```

```{r eval = TRUE, echo = FALSE}
set.seed(1234)
```


```{r stochProjection, echo=TRUE,fig.width=6,fig.height=4,fig.align='center',fig.cap="An example of stochastic population projection (100 simulations for 50 generations)"}
#Simulating stochastic geometric population growth rate

#Simulation settings (try changing these)
mean.r = 0.05 # the mean value of r
var.r = 0.1 # the variance in r (stochasticity)
startPop = 10 # pop size at start
nGen = 50 # number of generations
nTrials = 100 # number of repeated simulations

####################################################################
#If you are unfamiliar with R, do not edit anything below this line!
####################################################################

pseudoExtinction = 1

# First randomly generate some lambda values
rValues<-matrix(rnorm(nTrials*nGen, mean = mean.r, sd = sqrt(var.r)),ncol=nTrials,nrow=nGen)

# Use a histogram to see what they look like (uncomment the line below)
# hist(lambdas,col="grey",main="")

# Now run the simulations to see what the resulting population growth looks like
trials = matrix(data = NA, nrow = nGen, ncol = nTrials)
for (j in 1:nTrials){
  popSize = startPop  
  for (i in 2: nGen){
  stoch.r = rValues[i,j]
  popSize = append(popSize, popSize[i-1]*exp(stoch.r))
}
trials[,j] = popSize
rm(popSize)
}

#Calculate probability of (pseudo)extinction
minvals <- apply(trials,2,min)
nExtinct <- length(minvals[minvals<=pseudoExtinction])
nExtinct/nTrials

#Make a plot of the population trajectories
plot(1:nGen,log(seq(0.1,max(trials),length.out=nGen)),type = "n",axes=F,xlab ="Time", ylab = "N",ylim=log(c(0.1,100000)))
matlines(log(trials),col = "#FF234520",lty=1,lwd=3)
axis(1)
axis(2,at = log(c(0.1,1,10,100,1000,10000,100000)),
     label = c(0.1,1,10,100,1000,10000,100000))
abline(h=log(pseudoExtinction),lty=2)
```

<!--chapter:end:1_03_StochasticGrowth.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Basic logistic population growth


Population sizes have upper limits – they can only get so large. This is often modeled with the ‘logistic growth’ model^[This is equation 2.4 in Gotelli]: 

$N_{t+1}=N_{t}+r_{d} N_{t}\left(1-\frac{N_{t}}{K}\right)$

This equation models population at time $t+1$ ($N_{t+1}$) as a function of the population at time $t$ ($N_t$), the *discrete growth factor* ($r_d$), and carrying capacity of the environment ($K$). 

The idea is that the growth rate of the population (the difference between $N_{t+1}$ and $N_t$) decreases as the population increases in size. When the population size at $N_t$ is equal to the *carrying capacity* of the environment ($K$), the population growth rate is zero. For example, if the carrying capacity of the population is *200*, and there are already *200* individuals in the population, then the size of the population will remain unchanged through time ($N_{t+1} = N_t = 200$).

The aim of this Excel-based exercise is to explore this model and help you get an intuitive understanding of it by looking at it from different perspectives. Even though it is a fairly simple model, it leads us to some useful biological insights.

Download and open the Excel file: [`Basic Logistic Growth.xslx`](https://www.dropbox.com/s/oxxyyn4zf4wsvkg/Basic%20Logistic%20Growth.xlsx?dl=1).

You will see that there are three blocks of numbers, and three graphs.
During the exercise you only need to edit the pink block.

The pink block gives the important parameters of the logistic model:

*	`Initial N` = the starting population size at time 1.
*	`r_d` =  the maximum per capita population growth rate ($r_d$). When $r_d$ is 0, the population does not grow. When $r_d$ is $>$ 0 the population grows, and when it is $<$ 0 it declines. The population cannot fall below 0.
*	`K` = the carrying capacity of the population.

The initial values for these are *10*, *0.8* and *200* respectively.

In this exercises you will be altering these parameters and observing the outcome in the 3 graphs which show:

1.	The population size through time.
2.	The per capita growth rate of the population in relation to population size
3.	The relationship between population size at time t and at time t+1

## Graph 1

First – take a look at **Graph 1**. 

*	What is the maximum population size? 
* How does this compare to carrying capacity (`K`)? 
* What do you predict to happen if you increase `K` to *300*? (try it)

<!--You should notice that when `r_d` is around 1 or lower, the maximum population size is the same as the carrying capacity (`K`). As you change `K`, this maximum population size will change accordingly. 
If `r_d` is markedly greater than 1, then the population size can exceed the carrying capacity. This is because the population grows so fast that it “overshoots” carrying capacity and then fluctuates around `K`.-->

* At what time do you reach the maximum population size? 
* If you halved the discrete growth factor (`r_d`) to *0.4*, what do you think will happen to the dynamics this time? (try it)

<!-- You should notice that the time taken to reach the maximum population size is related to the growth rate (`r_d`). As you increase `r_d`, the time taken to hit the maximum population size decreases. If you halve the `r_d`, the time taken to reach maximum population size is doubled.
-->

* What do you think will happen if you `r_d` to *1.8*? (try it)
* What do you notice about the population size through time? 
* How does the maximum population size compare with the carrying capacity? How would you describe the ‘*dynamics*’ of this population?

<!--You should notice that the population overshoots carrying capacity (`K`), then oscillates around `K` with damped oscilllations that gradually move towards `K`. Therefore if a population has even a moderate population growth rate, and if it has density-dependence, then it can fluctuate in numbers without any extrinsic factor (like weather) acting. 
-->

* What happens if you increase the `r_d` even more, to *2* or *2.1*? 
* And even more to *2.8*, *2.9* or *3*? 
* How would you describe these dynamics? 
* Is there a limit to how high `r_d` can be? (hint: populations go extinct if N $<$ 0).

<!--
You should notice that as you increase `r_d` the nature of the oscillations changes. In fact, this is predictable:  If `r_d` $<$ 1.0, then population will approach `K` smoothly.

If 1.0 $<$ `r_d` $<$ 2.0, then oscillations of decreasing amplitude around `K`.

If 2.0 $<$ `r_d` $<$ 2.57, then stable, cyclic oscillations around `K` . They can be 1 or 2+ point stable limit cycles.

If `r_d` $>$ 2.57, then population will fluctuate chaotically.

If `r_d` is too high, the population will fluctuate and crash to extinction.
-->

Finally, compare the population trajectory in **Graph 1** for populations with `r_d`= *2.8* and *2.81*. Then compare the trajectories where you fix `r_d` at *2.8* but vary initial population size by a small amount (e.g. *1*). Imagine you were a population manager – would these populations be easy or hard to predict? What kinds of species have high population growth rates like these?

<!--
When `r_d` is high ($>$ 2.57) the population dynamics become extremely hard (impossible) to predict because they are chaotic. This means that even a very small change in `r_d` (which could simply be measurement error) will mean that predicted population size next year is suddenly very different. This would cause big problems to a population manager.

Many pest species and diseases have very high population growth rates. For example, locusts, or measles. This is one reason why it is hard to predict when the next pest/disease outbreak will happen
-->


## Graphs 2 & 3

Now let’s turn to **Graphs 2** and **3**.

In **Graph 2**, notice that the per capita growth rate always declines linearly with population size (`N`). Where does it cross the x-axis line? Modify the carrying capacity (`K`) – what do you notice?

<!--
The line describing per capita growth rate crosses the x-axis (population size) at $K$. i.e. if $K$ = 100, the line crosses at 100. If you change $K$, the intercept on the axis also changes accordingly. The line intercepts the axis at this point no matter what the population growth rate is.
-->

**Graph 3** is shaped like a parabola, starting with small values, increasing to a maximum, then declining to small values again. The position of the maximum is dependent on the values of `K` and `r_d`. When `r_d` is small (around *1*), the peak is at $x = K$ and $y = K$. Explore (1) how the peak moves around if you fix one of `K` or `r_d` and alter the other parameter and (2) how the slope of the line changes at $N_t = K$. 

*Hint: the slope of the line changes from positive to negative as `r_d` increases.*

<!--
As mentioned above, the peak of the parabola will be at `K` on both axes when `r_d` is small.  You should see that this makes sense because if the population is at carrying capacity in Year 1 ($N_t$, on the x-axis) then next year (Year 2; $N_{t+1}$ on the y-axis) the population size will be the same because with logistic growth the population growth rate is always 0 when the population is at carrying capacity. Therefore, if you change $K$, the peak will move around accordingly, but always will be at $x = K$ and $y = K$.

If you increase `r_d` above 1, the shape of the relationship between $N_t$ and $N_{t+1}$ remains parabolic, but the location of the peak changes relative to $K$.

-->


```{block, type="do-something"}
These three graphs are simply different ways to visualize the same model. It is important that you can make the connections between these graphs.

How would the same plots look for regular exponential growth?
```

Some useful keywords:

* Oscillation
* Cycle/cyclic dynamics
* Stable-limit cycle (2-point, 3-point limit cycle)
* Chaos/Chaotic dynamics
* Unpredictable/predictable

<!--chapter:end:1_04_BasicLogisticGrowth.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Deeper into logistic growth

The purpose of this exercise is (i) to look at the relationships between the exponential (or geometric) growth model and the logistic growth model and (ii) to emphasise different ways of looking at the models.

I will begin by showing the equations on the blackboard/whiteboard for exponential and logistic growth. I will highlight how the logistic model is a simple extension of the exponential model. I will show that when K is infinite the model $\frac{d N}{d t}=r N\left(1-\frac{N}{K}\right)$,  simplifies to the exponential model ($\frac{d N}{d t}=r N$), because the $(1-\frac{N}{K})$ bit drops out of the equation.^[These are equations 2.1 and 1.1 in Gotelli.]

The same is true for the discrete version of the logistic growth model: Compare the equation  $N_{t+1}=N_{t}+r_{d} N_{t}\left(1-\frac{N_{t}}{K}\right)$ with $N_{t+1}=N_{t}+r_{d} N_{t}$. ^[These are Expression 1.13 (page. 11) and equation 2.4 from Gotelli.]

You can then look at the Excel file [`Deeper Into Logistic Growth.xlsx`](https://www.dropbox.com/s/4xq399z7skl1akv/Deeper%20into%20Logistic%20Growth.xlsx?dl=1).


## Different views of the basic logistic growth model

Take a look at the `BasicLogistic` Excel worksheet/ark. 

Focus first on **Figure 1**.

Enter different values for `r_d`, e.g. 0.8, 1.2, 1.8, 2.4, 2.7…

Can you describe the dynamics of the population time series in Figure 1 using some of the following vocabulary: Oscillation, damped oscillation, stable cycle, 2-point cycle, chaotic, unpredictable, predictable?

Now focus on **Figure 2**.

This figure shows the per capita population growth rate as a function of population size at time $t$. Note where the line intercepts the x- and y-axes. 

What do you notice about these values? Hint: what are the values you have set for `r_d` and `K`? Try varying those values.

On paper, make a sketch of a graph for per capita population growth rate as a function of population size at time t for a logistic model with $r_d$ = 1.5 and $K$ = 250, indicating the values of the intercepts. Check your sketch by entering those values into the Excel model.

Based on what you know about what happens to the population dynamics for different values of $r_d$ and what you have just seen in Figure 2, you should now be able to sketch fairly accurate cartoon graphs if you are given values for $r_d$ and $K$! 

*Without using Excel*, draw a population time series, and a graph of per capita growth rate vs. N for when initial population size is 10, $r_d$ is 1.9 and $K$ is 500. Check your graph using Excel.  

Focus now on **Figure 3**.

Population growth rate is $dN/dt$ - the rate of change in $N$ ($dN$, change in population size) per unit time ($dt$). You should now explore how *Figure 3* relates to the values used in the equation by changing the $r_d$ and $K$ values and looking at *Figure 3*. 

Can you see how *Figures 1*, *2* and *3* are connected?

At what population sizes is the population growth rate 0 ($dN/dt$)?
What is the population size at which the population growth is rate maximized? 

Now lets look back on **Exponential growth**.

How do the relationships in Figures 1, 2 and 3, differ from the equivalent figures for logistic growth. Try to draw graphs of Figures 1, 2 and 3 for the exponential growth model.

*	Fig 1. Population size ($N$) through time ($t$).
*	Fig 2. Per capita growth rate ($\frac{1}{N} \frac{dN}{dt}$) vs. population size ($N$)
*	Fig 3. Population growth rate ($\frac{dN}{dt}$) vs. population size ($N$) (see figure 2.4 in Gotelli)


## Adding a time lag

This relates to *Equation 2.3* in Gotelli (and pages 32-35).

$\frac{d N}{d t}=r N\left(1-\frac{N_{t-\tau}}{K}\right)$

Look at the Excel Worksheet/Ark called `TimeLag`.

Adding a time lag to logistic model can complicate the dynamics (by introducing cycling). The 3rd Excel tab has an exercise showing that if you add in a time lag to the logistic function it modifies the dynamics. The purpose of this Excel sheet is to allow you to prove this to yourself!

You will need to carefully modify the Excel formula so that instead of referring back to the population size at $N_{t-1}$, it refers back to $N_{t-1}$ etc. Remember to drag the formula down to all the other years (or use the shortcut I will show you).

Start with a small $r_d$ that gives a smooth convergence to K with an ordinary logistic model. Add in a 1-year time lag and show that this generates cyclic dynamics. This shows that this simple “quirk of life history” (a time lag) can generate cycling, even if the population growth rate is low.
 
## Optional: Cobweb diagrams

The cobweb diagram is another useful tool to visualize and explore dynamics of logistic models. See the book section by Mathiopoulos on itsLearning. They would be very hard to implement in Excel, so I have made a webapp: (https://jonesor.shinyapps.io/cobweb/)

The graph shows a “track” which follows the fate of a population. The track bounces between the parabola describing the relationship between $N_t$ and $N_{t+1}$ (Figure 3.1 in the excel sheet) and a 1:1 line. Try altering $r_d$ in the model and observe what different types of dynamics look like with this “view”. Check out what happens if you modify the starting population size. You should see that for non-chaotic dynamics, the starting population size doesn’t affect the fate of the population. For example, set initial population to be 0.01, and $r_d$ to be 0.9. You should see damped oscillations. Now move the initial population slider. You should see that the population always ends up with the same dynamics, heading towards carrying capacity.

<!--
knitr::include_app('https://jonesor.shinyapps.io/cobweb/', height = '600px')
-->

<!--chapter:end:1_05_DeeperIntoLogistic.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Life tables and survivorship types

Life tables are tables that shows for each age, the probability that an individual of that age will die before the next birthday (*probability of death*). This exercise deals with so-called **cohort life tables** which, as the name implies, follows a “*cohort*” of individuals from birth until they all die. A cohort is the group of individuals born within a particular time interval (e.g. “*all individuals born in 1998*”).

Life tables have been used extensively in population biology, in human demography and in epidemiology. They are also important outside of biology, e.g. in the management of product life-cycles, such as in cars or other machinery.

The basic algebra used in life tables is explained in Gotelli Chapter 3 (see table 3.1 for an example).

The purpose of this exercise is:

1. to allow you to calculate a life table yourself in Excel;
2. to develop your Excel modeling skills by asking you to make the
calculations following the equations given in Gotelli (and in the lecture
slides);
3. to allow you to explore different types of survivorship (Type I, II and III)
and consider the relationship between these life tables and “life history strategy” (more on this in the evolution part of the course).

Open the Excel file `[Life tables exercises.xlsx](https://www.dropbox.com/s/ox0rk05zdwzrmwy/Life%20tables%20exercises.xlsx?dl=1)`.

The file has three worksheets (“*Life table*”, “*Survivorship Curves*” and “*Gotelli
Table 3.1 example*”.

Let’s start with “**Life table**”.

The aim now is to use Excel as a modeling tool to produce a life table. I have provided some initial data collected from a cohort of animals. I know how many individuals survive each year (how many “enter the interval”). I also know how many babies (on average) are produced by each female.

Start by calculating survivorship ($l_x$). Survivorship is the **probability of survival to a particular age**. Therefore, at time 0, $l_0 = 1$, since everyone is alive at this point. The next value ($l_1$) must be calculated based on the number alive at that point. In this case it is $352/500 = 0.704$. You must generalize this calculation into a formula that can be dragged to fill column `D` in the worksheet. In algebraic form, the equation is $l_x = S_x/S_0$.

Next, you can calculate age specific **survival probability**. Note that this is different from lx. Survival probability is simply the probability that an individual will survive its current age class. i.e. what is the probability that an individual currently aged 2 will survive to become age 3. In this case, the $254/298 = 0.852$. The calculation is $g_x = l_{x-1}/l_x$, or $S_{x-1}/S_x$.

Now complete the remaining two columns, and use them to calculate (a) $R_0$; (b) **Generation time**; and an approximation of $r$.
**Tip** You need to understand the use of the `$` symbol in Excel, and how to drag the selected area to place the formula in the column. Refer to the sheet “*Gotelli Table 3.1 example*” if you get stuck (you should be able to see the formulae used there.

In the second part we focus on the **Survivorship Curves** worksheet.
The aim here is to start to explore how different types of organisms with different ways of life (“**life history strategies**”) can have qualitatively different kinds of life tables. The most important thing to observe is the difference in **survivorship curves** ($l_x$). These changes become very obvious when you plot the log-transformed survivorship against age.

In the Excel worksheet, I have placed tables showing the fate of cohorts of three populations of different species. Your job now is to calculate the survivorship curve ($l_x$) for these species, take the natural log (using formula `=log(C3)`, for the first population, `=log(H3)` for the second population etc.

You should see that the graphs automatically fill up with lines. These show Type I, II and III survivorship.

<!--chapter:end:1_06_LifeTables.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Matrix population modelling

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(tidyverse)
```

Think of an organism you would like to model the dynamics of. It could be a mammal, a bird, a fish, insect or tree ... real or fantasy. 

Think about their life cycle, and draw it as a life cycle diagram with circles indicating the stages and arrows representing transitions between stages and reproduction. Next to the arrows, write values for survival probability and fecundity (number of babies) using your biological knowledge.

Things to think about:

* Is it age based or stage based?
* How many stages are there?
* If it is stage, how are stages defined? E.g. by size, by development, etc.
* Are the survival and fecundity higher in earlier or later life?
* Does the organism skip stages?
* Does the organism move backwards through the life cycle?

```{r,echo=FALSE,out.width = "30%"}
x <- data.frame(x = 0:4,y=0:4)
(p1 <- ggplot(x) + 
    geom_blank() + 
    theme_minimal())
```

Turn this diagram into a matrix population model by filling in a square of survival/fecundity values. There is space below for up to a 4-stage matrix model.

```{r,echo=FALSE}
p1 + 
  #geom_vline(xintercept = 0:4) + 
  #geom_hline(yintercept = 0:4) +
  geom_segment(aes(x = 0,xend=0,y = 0,yend=4)) +
  geom_segment(aes(x = 1,xend=1,y = 0,yend=4)) + 
  geom_segment(aes(x = 2,xend=2,y = 0,yend=4)) +
  geom_segment(aes(x = 3,xend=3,y = 0,yend=4)) +
  geom_segment(aes(x = 4,xend=4,y = 0,yend=4)) +
  
  geom_segment(aes(x = 0,xend=4,y = 0,yend=0)) +
  geom_segment(aes(x = 0,xend=4,y = 1,yend=1)) + 
  geom_segment(aes(x = 0,xend=4,y = 2,yend=2)) +
  geom_segment(aes(x = 0,xend=4,y = 3,yend=3)) +
  geom_segment(aes(x = 0,xend=4,y = 4,yend=4)) +
  
  xlab("") + ylab("") +
  theme(
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank())+
  
  NULL
```

Working with matrices is very tedious in Excel. However, in R you can use this information to predict the future dynamics of the population, and estimate population growth rate, and generation time etc.

Open up **RStudio**, and lets see if we can predict future dynamics. First you will need to install a package called `popdemo`.

```{r,eval=FALSE}
install.packages("popdemo")
```
 
You only need to install packages once. After thatyou can load the package for use by using the `library` function.

```{r, message=FALSE}
library(popdemo)
```

You can put your matrix into R like in the example below (change the numbers to match YOUR model). If your model has fewer, or more, stages then you will need to modify the code a bit. Ask for help if you get stuck.

```{r}
    A <- matrix(c( 0.00, 0.00, 4.00, 2.00,
                   0.10, 0.00, 0.00, 0.00,
                   0.50, 0.20, 0.00, 0.00,
                   0.00, 0.30, 0.40, 0.30),
                byrow = TRUE, nrow = 4)
```

And now you can use the project function to project what happens to the population, then plot it. Look at what happens if you log or don’t log the y-axis. First you need to define an initial starting population structure. 

In my example, I have 4 stages, so I have 4 values for the initial population sizes. Then I use the `popdemo` function `project` to do a population projection for 10 time steps.

```{r}
initial <- c(10,5,3,3)
pr <- popdemo::project(A, vector = initial, time=10)
```

Take a look at `pr`, the projected population. This gives you the total population size, and below that the population sizes in each stage. 

```{r}
pr
```

You can access the population sizes of the different stages using `vec(pr)`.

```{r}
vec(pr)
```

Let's plot this... 

```{r}
pop <- vec(pr)
matplot(pop,type="l",log="y")
legend("topleft",legend = colnames(pop),col=1:ncol(pop),lty=1:ncol(pop))
```

You should see that the population increases exponentially. The population growth rate is the so-called "*dominant eigenvalue*" of the matrix **A**.

We can ask R for the  *eigen values* and *eigen vectors*. These are the population growth rate ($\lambda$) and the stable stage distribution (*SSD*) and the reproductive values (*RV*) of the different stages. *SSD* is the expected *proportion* of individuals in the different stage classes at equilibrium and *RV* is the expected number of future offspring by individuals in each stage.

You can see that in this case, using my example values the population is growing `r format(100*(eigs(A)$lambda-1),2,4)`% per year.

```{r}
eigs(A)
```

## Your turn...


1) by editing the inputs in the code above, make a projection for **your** data.
2) plot the results (using the R code here)
3) what is the health of your population?

## An evolutionary experiment

You can think of lambda (population growth rate) as being a measure of fitness. Imagine that some of your population had a mutation that caused them to have, say, 1 extra baby, but at the expense of reduced survival in one of the younger stages. Would this mutation persist in the population?


<!--chapter:end:1_07_matrixModels.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Lotka-Volterra competition

In ecology the there is a "rule" called the "competitive exclusion principle" which states that two species cannot coexist unless their niches are sufficiently different. 

How different do their niches need to be for coexistence? The general idea is that coexistence can occur if each species limits its own population growth rate more than it limits the growth rate of the other species. 

If there the niches overlap too much, one species will competitively exclude the other (i.e. forces the other to extinction).

In this class you will be working from a PDF available [here](https://www.dropbox.com/s/oukr39oq0rsn8il/9.%20Interspecific%20Competition%20and%20Competitive%20Exclusion.pdf?dl=1) to explore this idea.

This PDF walks you through the creation of an Excel spreadsheet exploring interspecific competition and competitive exclusion using the Lotka-Volterra model. 

Your task:

* Create the Excel spreadsheet by following the instructions in the PDF
* Use the Lotka-Volterra model you have created to answer the questions at the end of the PDF.


### The questions

1.  What parameter values will cause species 1 to exclude species 2 from the habitat? What do these values mean in ecological terms?
2. What parameter values will reverse this outcome? What do these values mean in ecological terms?
3. What parameter values will allow the two species to coexist indefinitely and stably? What do these values mean in ecological terms?
4. Are there parameter values under which the outcome depends on initial population sizes or rates of population growth? What do these values mean in ecological terms?


<!--chapter:end:1_08_LotkaVolterraCompetition.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Lotka-Volterra predator-prey dynamics

In the classic Lotka-Volterra predator-prey model (Rosenzweig and MacArthur 1963), the predator and prey populations grow exponentially. Modifications to the model include the availability of refuges (places where the prey are safe from predators) and carrying capacity (i.e. using logistic growth).

In this class you will follow a PDF worksheet ([here](https://www.dropbox.com/s/bhwoe161wp9p6hp/10.%20Predator-prey%20dynamics.pdf?dl=1)) which guides you to build and explore a Lotka-Volterra predator-prey model in Excel. The model has parameters for the prey and for the predator, and you will explore how these parameters influence the dynamics of the populations.

The worksheet is divided into three parts. We will mainly **focus on Part 1** - the basic model - in the class. 

Part 2 modifies the basic model to include a refuge, and part 3 modifies the model to include carrying capacity. Feel free to continue to work on these if there is time, and if you are interested.



### Reference 
Rosenzweig, M. L. and R. H. MacArthur. 1963. Graphical representation and stability conditions of predator-prey interactions. *American Naturalist* 97: 209–223.

<!--chapter:end:1_09_LotkaVolterraPredatorPrey.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# (PART) Evolution {-}

<!--chapter:end:2_00.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# From population biology to fitness

The purpose of this practical is to draw clear links between the first part of the course (population biology) and the second part of the course (evolution).

We will focus on the concept of **fitness**.

Fitness is a slippery concept, but it is widely accepted that it is closely related to population growth rate. In this class you will explore this concept using some mathematical modelling (aagh!).

```{block, type="do-something"}
This practical uses RStudio (R). It is similar to the previous exercise on matrix population models, but ask for help if you get stuck!
```

## An *in silico* experiment

As you learned in the classes on age and stage structured population dynamics differences in survival and reproduction can be modelled using matrix population models (MPMs). These models can be simple or complex, and can be thought of as mathematical descriptions of the life history of the species (or population) in a particular environment.  

In an earlier you will have played with construction and analyses of these models by creating MPMs for species with different life histories such as high juvenile survival, or low juvenile survival etc.

We will first need to load the `popdemo` package like this. Note that if you have not installed this package you should first install it with the command `install.packages("popdemo")`.

```{r,message=FALSE}
library(popdemo)
```


Let's set up our baseline model. This model describes a population of some mammal species which we have divided into 3 stages: juvenile, adult and senescent (old). 

```{r}
A1 <- matrix(c(0.00, 4.00, 2.00, 
               0.10, 0.80, 0.00, 
               0.00, 0.10, 0.40), 
            byrow = TRUE, nrow = 3)
```

You can "read" the matrix by looking at the columns and rows: a value in the column **3** and row **1** tells you the "transition" **from** stage 3 **to** stage 1. In this case, it is saying that an individual in the adult age class produces an average of 5 babies, and one from the senescent age class produces 1 baby. Juveniles have a probability of 0.1 (10% chance) to survive to adulthood (and they reach maturity in 1 year, so there is no "stasis" where they can remain being juveniles). Adults can survive in 2 ways, they can survive and remain as adults (probability = 0.8) or they can survive and transition to being in the sensescent age class (probability = 0.1). Therefore, the total survival probability is 0.9. Senescent adults survive less well (probability = 0.4).

We can project a population like this:

```{r}
initial <- c(10,5,3) # just some random numbers
pr <- popdemo::project(A1, vector = initial, time=8)
```

Take a look at `pr`, the projected population. This gives you the total population size, and below that the population sizes in each stage. 

```{r}
pr
```

You can access the population sizes of the different stages using `vec(pr)`.

```{r}
vec(pr)
```

Let's plot this... Check out how, after a "transient" period, there is exponential growth in all stages of the population. The population is growing steadily with a fixed population growth rate ($\lambda$).

```{r}
pop <- vec(pr)
matplot(pop,type="l",log="y")
legend("topleft",legend = colnames(pop),col=1:ncol(pop),lty=1:ncol(pop))
```

You can see that the population is increasing and we can calculate the precise population growth rate ($\lambda$) like this:

```{r}
eigs(A1)$lambda
```

Thus, the population is growing at `r format(100*(eigs(A1)$lambda-1),2,4)`% per year.

So where does evolution come in?

## The link to fitness

In this population consider that suddenly a mutation arises in an individual parent that causes it to give more care to their offspring. For example, maybe they provide milk with a higher fat content, or build a safer nest. Whatever the mechanism, let's assume that it results in a small increase in juvenile survival. 

We can simulate this by increasing the juvenile survival in the matrix model from 0.10 to 0.11.

```{r}
A2 <- matrix(c(0.00, 4.00, 2.00, 
               0.11, 0.80, 0.00, 
               0.00, 0.10, 0.40), 
            byrow = TRUE, nrow = 3)
```

What effect does that have on population growth rate?

```{r}
eigs(A2)$lambda
```

The small increase in juvenile survival has resulted in a small increase in population growth rate, from `r format(100*(eigs(A1)$lambda-1),2,4)`% to `r format(100*(eigs(A2)$lambda-1),2,4)`% per year.

If you consider that the original population now consists of two genotypes -- "ordinary" and "caring" -- what do you think will happen to the percentage of the two genotypes through time?

You can be sure that the proportion of the caring genotype will grow faster than the ordinary genotype. It is the FITTER genotype.

## Introducing a trade-off

It is common that apparently beneficial behaviours or innovations come at a cost. In evolutionary biology these are called **trade-offs**. 

Let's explore such a trade-off now and see how it might affect fitness.

We'll stick with the same example above, but we'll introduce a new genotype that has a trade-off between juvenile survival and old-adult survival. 

The benefit is clear: a change in adult behaviour or physiology increases juvenile survival a little bit. 
But such changes often come with a cost: The new genotype allocates extra resources to babies but this exhausts the adults causing older adults to have very small survival probability. 

Is this new genotype viable? In other words, is the fitness of the genotype greater than that of the original genotype? If so, the new genotype will come to dominate the population.


```{block, type="do-something"}
Modify the matrix to reduce old adult survival to, say 0.05 (5% survival) and re-calcualte the population growth rate.

Is this "trade-off genotype" fitter than the original one? i.e. is the small benefit worth the large cost?

Try doing the same thing for the prime-age adults. How much can you reduce survival before the cost is not worth bearing?
```
<!---
```{r}
A3 <- matrix(c(0.00, 4.00, 2.00, 
               0.11, 0.80, 0.00, 
               0.00, 0.10, 0.20), 
            byrow = TRUE, nrow = 3)

eigs(A3)$lambda
eigs(A1)$lambda
```
-->

<!--chapter:end:2_001_FromPopulationToEvolution.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Bug hunt camouflage (Netlogo)

Adaptive evolution: Bug Hunt!

In this exercise you are going to impose selection pressure on a creature on a virtual landscape. The exercise is done using one of the built-in models in NetLogo (https://ccl.northwestern.edu/netlogo/).
Open NetLogo and click File > Models Library. You can then use the search box at the bottom of the screen to find the model called “Bug Hunt Camouflage”.
This is a model of natural/artificial selection that shows how a population hunted by a predator can develop camouflaging. For example, in a forest with green leaves, green bugs may emerge as the predominant bug color.
In the simulation you assume the role of a predatory bird that feeds on insects, which can be different colours.  You will see what effect your hunting has on the colour traits/genetics of these simulated insects, and also how this evolution affects your hunting efficiency.

## Getting started

1. When you open the model, you will see a screen with various purple and green “sliders”, buttons and menus that control parts of the model.
2. Start with 30 bugs, by moving the “carrying-capacity” slider until it reads 30.
3. Now click “setup”. You should see the environment appear on the right hand side, and you should see a few “bugs” on the environment. Start the simulaton by clicking “go”. 
4. After you click go, you need to click on bugs as fast as you can using your mouse/track pad. You can also keep the mouse button depressed, and move the cursor around the world to catch the bugs. Try to consume bugs as fast as possible to remove any “deliberation” on your part as a predator. The camouflaging effect will emerge more clearly if you aren’t taking your time trying to find bugs that typically would be more difficult to find.

You can track your progress by looking at the graphs on the left. The most important of these are the two at the top, which show (1) the number of bugs caught through time and (2) the average colour values of the bugs.

In the “Bugs Caught vs. Time” plot the slope of the curve gives a good idea of your hunting efficiency – the faster you can catch bugs, the steeper the slope. If you didn’t catch any bugs for a while, the slope would be horizontal.

You should notice that bugs with contrasting colours (e.g. black on white) are easier to catch.  Keep hunting for 2 mins or until you can’t find any more bugs then pause the simulation by clicking “go” again. Now take a look at the graphs and see what effect your hunting has had on the phenotype distribution in the population.

To understand what’s going on, you need to understand how the simulation works.

 
### How the simulation works.

*Simple version:* 
The simulation starts with bugs with random colours.

Each time you kill a bug, one of the remaining bugs produces an offspring so that the population size stays constant. The colour of the offspring is inherited from its parent, though it can change slightly due to mutation (determined by the “max-mutation-step” slider). Therefore, the offspring of a red parent will be reddish, the offpring of a blue parent will be blueish and so on. Therefore, if you consistently kill off (e.g.) non-reddish bugs, the reddish bugs that remain will have offspring that are also red and the average colour of the population will then shift towards being redder. 

Colour here is indicated by “hue”, “saturation” and “brightness” which range from 0 to 255. Basically, hue describes colour value (red/green/blue), saturation describes how “washed out” or vivid the colour is (a low value for saturation would look white), and brightness describes how bright the colour is (a low value for brightness would look black). See below for more details.

Evolution can be defined as: “*change in the heritable characteristics [colour traits] of biological populations [bugs] over successive generations [time].*” 

## Questions

Answer the following questions, then make sure you confirm your understanding and have the right answers with an instructor.

*	What happens to the average colour of the bug population with time as you hunt? 
*	What happens to your hunting efficiency?
*	Would you say that the bug population becomes worse or better adapted to their environment?
*	Can you explain how this happens?
*	After simulating in one environment (e.g. poppy field) for a few minutes, pause then switch to another environment. Are the bugs now well- or poorly-adapted to their environment?
*	Do the genotypes of individuals change (e.g. with individual age)?
*	Increasing the “max-mutation-step” makes bug offspring less like their parents. How do you think this will influence the speed of adaptation of the bugs?

Some useful keywords:

*	Selection
*	Adaptation
*	Selection pressure
*	Heritability


## Details about colours (optional) 

The primary colours red, green and blue (RGB) can be mixed to produce any colour (this is how the pixels of TVs and computer monitors work if you look closely). Mixtures of these colours are also used to control the colour of the bugs. Each bug has three pigment “genes”  (R, G and B) that determine their colour phenotype. The more frequently the gene for a pigment is coded for, the stronger that presence of color is in the overall blend of pigments that results in a single phenotype for coloration. For example, a bug that had lots of R, but little G or B would appear as red. In this simulation RGB can vary from 0 to 100.  The mixture of these primary colours results in a colour which has a particular **hue**, **brightness** and **saturation** (Fig  \@ref(fig:colours)).

**Hue** ranges from 0 to 255 with both ends of that spectrum being red, and as you move from 0 to 255 you pass through all the colours of the rainbow.

The other two elements of colour are **brightness** and **saturation**. If a colour is bright it is very vibrant, if it is not bright, it is dark: a brightness value of 0, would be black, no matter what the hue was. Similarly, a low saturation values give “washed out” colours and a valeue of 0 would be  white. 


```{r colours, out.width="50%",fig.align='center',echo = FALSE, fig.cap="Hue, brightness and saturation"}
knitr::include_graphics('images/colours.png')
```

Read more about the model here: http://ccl.northwestern.edu/netlogo/models/BugHuntCamouflage

<!--chapter:end:2_01_BugHuntCamouflage.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Neutral or adaptive evolution in humans?

## Objective

The objective of this exercise is to develop an intuitive understanding of the effect of selection and genetic drift on traits. 

## Background

Traits that are under moderate or strong selection will tend to be restricted to some optimal value, or change directionally -- natural selection leading to adaptive evolution.  Traits that are under weak or no selection will not be restricted so much so will tend to change via a random process -- random genetic drift leading to neutral evolution.  Both of these changes require the existence of variation in the trait to begin with: if there is no, or very little, variation the trait will not respond much even if there is strong selection. 

Finally, the strength of selection will largely depend on the environment. Traits may be important in some environments but not others. There may also be traits that would be selected for in some environments, but against in others. E.g. production of the skin pigment, melanin, would be selected for in areas with high UV-radiation since it protect against skin cancer, but selected against in cool temperate zones with low UV radiation since it inhibits the ability to make vitamin D (deficiency is a health risk). 

```{r huntergatherer, out.width="50%",fig.align='center',echo = FALSE, fig.cap="How will selection differ between these environments?"}
knitr::include_graphics('images/huntergathererDK.png')
```

## Your task

You are given a list of traits for humans (below). In small groups, write the traits onto PostIt notes. Then discuss them and place the traits in order of strength of natural selection that you think would be acting on the traits in hunter-gatherer-type societies. These populations are likely to be experiencing the conditions that humans have experienced over most of our time as a species.

This should result in an ordering of the traits from ones which would evolve only by the neutral process of **GENETIC DRIFT** and ones that would evolve by **ADAPTIVE EVOLUTION** via **NATURAL SELECTION**.

Now repeat this exercise for humans in modern industrialised countries like Denmark.

## The traits

```{r echo = FALSE, message=FALSE, eval=knitr::is_html_output()}
traits<-read_excel("CourseData/humanevoltraits.xlsx")
traits_mat<-matrix(traits$Traits,ncol = 2,nrow=8)
traits_mat<- as.data.frame(traits_mat)
traits_ft<-flextable(traits_mat) %>% delete_part(part="header") %>% 
  width(width = c(4,4)) %>% 
  fontsize(size = 16) %>% 
  border_remove()
traits_ft
```


<!--chapter:end:2_02_NeutralOrAdaptiveEvolution.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Hardy-Weinberg equilibrium

## Problem #1.

You have sampled a population in which you know that the percentage of the homozygous recessive genotype (aa) is 36%. Using that 36%, calculate the following: 
*	The frequency of the "aa" genotype. 
*	The frequency of the "a" allele. 
*	The frequency of the "A" allele. 
*	The frequencies of the genotypes "AA" and "Aa." 
*	The frequencies of the two possible phenotypes if "A" is completely dominant over "a." 

## Problem #2. 

Sickle-cell anemia is an interesting genetic disease. Normal homozygous individials (SS) have normal blood cells that are easily infected with the malarial parasite. Thus, many of these individuals become very ill from the parasite and many die. Individuals homozygous for the sickle-cell trait (ss) have red blood cells that readily collapse when deoxygenated. Although malaria cannot grow in these red blood cells, individuals often die because of the genetic defect. However, individuals with the heterozygous condition (Ss) have some sickling of red blood cells, but generally not enough to cause mortality. In addition, malaria cannot survive well within these "partially defective" red blood cells. Thus, heterozygotes tend to survive better than either of the homozygous conditions. 

*	If 9% of an African population is born with a severe form of sickle-cell anemia (ss), what percentage of the population will be more resistant to malaria because they are heterozygous (Ss) for the sickle-cell gene? 

## Problem #3. 

There are 100 students in a class. Ninety-six did well in the course whereas four blew it totally and received a grade of F.  In the highly unlikely event that these traits are genetic rather than environmental, if these traits involve dominant and recessive alleles, and if the four (4%) represent the frequency of the homozygous recessive condition, please calculate the following: 

*	The frequency of the recessive allele. 
*	The frequency of the dominant allele. 
*	The frequency of heterozygous individuals. 

## Problem #4. 

Within a population of butterflies, the color brown (B) is dominant over the color white (b). And, 40% of all butterflies are white. Given this simple information calculate the following: 

*	The percentage of butterflies in the population that are heterozygous. 
*	The frequency of homozygous dominant individuals. 


<!--chapter:end:2_03_HardyWeinberg.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# How many eggs should a bird lay?

## Objectives

The objective of this exercise is to get an understanding the trade off between the benefits of producing large numbers of offspring and the costs of reduced survival of those offspring. This is known as “Lack’s clutch size”.

## Background

David Lack was a British ornithologist who proposed that the number of eggs a bird should lay was the result of a trade-off between the benefits of producing large numbers of offspring, and the survival costs of feeding the chicks that hatch.

In other words, although it is beneficial in fitness terms to have many offspring, the survival of those offspring will decline if they cannot be cared for.

## Your task
The big bird (*Bigus canarius*) (Fig  \@ref(fig:bigbird)) can lay up to 10 eggs per breeding season. If there is only 1 egg, the probability that the parents can adequately feed the chick and ensure it survives is very high (0.9). However, as the number of siblings increases, the amount of energy and food that the parents can dedicate to caring for *each* chick decreases, and the probability of survival therefore declines . With a clutch size of 10 eggs, there is so little food *per chick* that the survival rates are close to zero.

```{r bigbird, out.width="50%",fig.align='center',echo = FALSE, fig.cap="Big bird, *Bigus canarius*"}
knitr::include_graphics('images/bigbird.jpg')
```

A recent study gathered data on chick survival probability as a function of number of eggs in the nest. These are given in the table below. 

```{r echo = FALSE, message=FALSE, eval=knitr::is_html_output()}
bbeggs <- data.frame(eggs = 1:10,survival = c(0.9,0.85,0.82,0.7,0.5,0.3,0.22,0.15,0.1,0.05))

bbeggs_ft <- flextable(bbeggs)
bbeggs_ft 

```
Use these data to plot a graph in Excel with number of eggs on the x-axis and survival probability on the y-axis axis.

Now, in another column in Excel, calculate, given the chick survival probability, what the expected number of surviving chicks will be for a big bird laying between 1 and 10 eggs^[This may require some thought!].

Plot your result on another graph with number of eggs on the x-axis and number of surviving offspring on the y-axis.

What do you notice? What is the optimum number of eggs to lay? 

Advanced: What happens to the optimum as you change the relationship between clutch size and survival.


<!--chapter:end:2_04_HowManyEggs.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Trade-offs and the force of selection


Why does evolution ‘care’ less and less about you as you age? Because there are trade-offs between early and late life events. 

## Objective

The aim of this exercise is to gain an understanding of early-life late-life trade offs. Specifically it is to understand why events early in life tend to be much more important to evolution than those that happen later in life.

## Background

An important kind of trade off are those which occur between early and late life. For example, it may be beneficial to increase reproduction at younger ages, but this might lead to increased risk of death at older ages. A mechanism for this could be that limited resources are allocated to producing offspring rather than maintaining/repairing the body.
Methods

Open the Excel file [TradeOffsAndForceOfSelection.xlsx](https://www.dropbox.com/s/7eyoencvqc3hwv7/TradeOffsAndForceOfSelection.xlsx?dl=1).

This file shows a simplified life table, following a cohort of 1000 individuals for a fictional creature. 

Survival rates from year to year are set to be 0.8 (i.e. 80% make it through to the next year). This fixed, constant survival rate leads to an exponentially declining survival curve, illustrated with a chart in the Excel file. Fertility (i.e. the number of babies produced per year) is set to be 10 per year.

The product of survival ($l_x$) and fertility ($m_x$), lxmx is a measure of the expected number of offspring in an age class. For a stable population the sum of these values ($\sum l_x m_x$) is a measure of net population growth rate (also known as $R_0$). $R_0$ is an excellent measure of fitness of a life history strategy.

Note that the initial $R_0$ is 49.811

## Exploring different life history strategies

**We will now use this data to explore how alternative life history strategies affect fitness.**

Consider a trade-off between early reproduction and late life survival (i.e. via resources allocated to body maintenance). In this scenario the species could increase reproduction early in life by allocating more energy to making babies. However, resources are limited and this will come at the expense of survival at a later date. A mechanism for this could be that the body no longer fixes cancers so effectively. 

* Simulate this by adding 1 to fertility ($m_x$) in year 1 (the benefit) but reducing survival to 0 (all die) at age 25 (the cost). *What is the fitness of this strategy?*
* By setting survival to 0 at other ages, determine how many years of life could be lost before this cost is no longer worth bearing. Is this surprising?
* Now reset everything ($m_x$ =10; survival = 0.8). Recall what fitness was when you added 1 to $m_x$ at age 1 (50.811). 

* If, instead of adding to $m_x$ at age 1 you were to increase $m_x$ at age 25, how much would you need to increase $m_x$ to to reach this figure?

* What about at age 20?   Age 15?  Age 10?  Age 5? 
Plot the increase required vs. age (make a new worksheet/ark in Excel) What do you notice?

* Reset everything again ($m_x$ =10; survival = 0.8). Set $m_x$ from age 15 onwards to be 0. Now alter survival rate after this point (at ages 15-25). What happens to fitness?


<!--chapter:end:2_05_TradeOffsForceOfSelection.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Making a phylogeny

[coming soon]

<!--chapter:end:2_06_MakingAPhylogeny.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Short answer exam discussion

[coming soon]

<!--chapter:end:2_06_ShortAnswerExam.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# The Red Queen Game

[coming soon]

<!--chapter:end:2_07_RedQueenGame.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# (PART) Solutions to exercises {-}

<!--chapter:end:3_00.Rmd-->

```{r include=FALSE, cache=FALSE}
#packages for the main content
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(patchwork)

#Packages for the web pages
library(xfun)
library(htmltools)
library(mime)
```
# Solutions and "take-home" messages

In this section you will find the solutions and/or main take home messages of the practical exercises used in this course.


```{asis, echo=today() > icalSchedule %>% filter(grepl("Ambalapuzha",Topic)) %>% select(DTSTART2) %>% pull()}
## Solutions: The legend of Ambalapuzha

You can find the completed Excel file [here](https://www.dropbox.com/s/ybe5qhmfltuhoyv/RiceOnAChessboard_completed.xlsx?dl=1).

Take home messages:

* Exponential/geometric growth is extremely powerful and can very quickly lead to very large numbers.
```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Geometric growth",Topic)) %>% select(DTSTART2) %>% pull()}
## Solutions: Geometric growth

You can find the completed Excel file [here](https://www.dropbox.com/s/sfxu1lbrxyqt462/GeometricGrowth%20-%20complete.xlsx?dl=1). 

Take home messages:

* The rate of exponential/geometric growth depends on the population growth rate.
* Lambda ($\lambda$) values $<1$ lead to a exponential *decrease*, while values $>1$ lead to exponential growth. A $\lambda$ of 1 indicates no change.
* Growth traj"ectories can be plotted on the "natural scale* or on a *log scale*. Exponential growth (or decline) plotted on a log scale is a straight line. This could be useful to infer biological processes (or the lack of them). For example, exponential growth in population size indicates that there are no forces currently limiting the population (e.g. predators/competition/management actions).

```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Stochastic population growth",Topic)) %>% select(DTSTART2) %>% pull()}
## Solutions: Stochastic population growth

You can find the completed Excel file [here](https://www.dropbox.com/s/baao06vi0c0quns/StochasticPopulationGrowth-complete.xlsx?dl=1).

Take home messages:

* Population growth rates are unlikely to be constant through time.
* Environmental stochasticity will cause changes through time in vital rates (birth/death) which will influence $\lambda$ (and $r$).
* We can model environmental stochasticity using a distribution of population growth rates instead of a single deterministic value.
* We then can randomly draw growth rate values from this distribution for each time-step in a population projection.
* The "spread" or uncertainty in the population size at a future time point depends on (i) the spread (variance) of the distribution and (ii) the amount of time elapsed. 
* We can repeatedly simulate a population projection (e.g. in R, or more laboriously in Excel) to get a feel for the likely fate of a population. E.g. "what percent of the projections show extinction within 50 years?".
* We can use this relatively simple and "unrealistic" model to nevertheless get an intuition about general trends in population dynamics and extinction risk.
* Extinction probability increases as (i) initial population size decreases; (ii) variance increases; (iii) growth rates decrease; (iv) the time frame increases.
```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Basic logistic population growth",Topic)) %>% select(DTSTART2) %>% pull()}
## Solutions: Basic logistic population growth

You were asked to use the Excel sheet to answer some questions about logistic growth by examining the graphs.

**First – take a look at Graph 1**. 

*	*What is the maximum population size?* 
*	*How does this compare to carrying capacity (K)?*
*	*What do you predict to happen if you increase K to 300?*
*	*Try doing that. Were you correct?*

You should notice that when the population growth rate ($r_d$) is around 1 or lower, the maximum population size is the same as the carrying capacity ($K$). As you change $K$, this maximum population size will change accordingly. 

If $r_d$ is markedly greater than 1, then the population size can exceed the carrying capacity. This is because the population grows so fast that it “*overshoots*” carrying capacity and then fluctuates around K.

*	*At what time do you reach the maximum population size?* 
*	*If you halved growth rate (r_d) to 0.4, what do you think will happen to this time? *
*	*Try doing that. Were you correct?*

You should notice that the time taken to reach the maximum population size is related to the growth rate ($r_d$). As you increase $r_d$, the time taken to hit the maximum population size decreases. If you halve the growth rate, the time taken to reach maximum population size is doubled.

*	*What do you think will happen if you increase growth rate to 1.8?* 
*	*Try that… were you correct?*
*	*What do you notice about the population size through time?* 
*	*How does the maximum population size compare with the carrying capacity?* 
* *How would you describe the ‘dynamics’ of this population?*

You should notice that the population overshoots carrying capacity ($K$), then oscillates around $K$ with damped oscilllations that gradually move towards $K$. Therefore if a population has even a moderate population growth rate, and if it has density-dependence, then it can fluctuate in numbers without any extrinsic factor (like weather) acting.

*	*What happens if you increase the growth rate even more, to 2 or 2.1?* 
*	*And even more to 2.8, 2.9 or 3?* 
*	*How would you describe these dynamics?* 
*	*Is there a limit to how high $r_d$ can be? (hint: populations go extinct if N < 0).*

You should notice that as you increase $r_d$ the nature of the oscillations changes. In fact, this is predictable:  If $r_d < 1.0$, then population will approach $K$ smoothly.

If $1.0 < r_d < 2.0$, then oscillations of decreasing amplitude around K.

If $2.0< r_d < 2.57$, then stable, cyclic oscillations around K . They can be 1 or 2+ point stable limit cycles.

If $r_d > 2.57$, then population will fluctuate chaotically.

If $r_d$ is too high, the population will fluctuate and crash to extinction.

*Compare the population trajectory in Graph 1 for populations with $r_d$= 2.8 and 2.81. Then compare the trajectories where you fix $r_d$ at 2.8 but vary initial population size by a small amount (e.g. 1). Imagine you were a population manager – would these populations be easy or hard to predict? What kinds of species have high population growth rates like these?*

When $r_d$ is high ($>2.57$) the population dynamics become extremely hard (impossible) to predict because they are chaotic. This means that even a very small change in $r_d$ (which could simply be measurement error) will mean that predicted population size next year is suddenly very different. This would cause big problems to a population manager.

Many pest species and diseases have very high population growth rates. For example, locusts, or measles. This is one reason why it is hard to predict when the next pest/disease outbreak will happen

**Now let’s turn to Graphs 2 and 3**

*In graph 2, notice that the per capita growth rate always declines linearly with population size ($N$). Where does it cross the x-axis line? Modify the carrying capacity ($K$) – what do you notice?*

The line describing per capita growth rate crosses the x-axis (population size) at $K$. i.e. if $K = 100$, the line crosses at 100. If you change $K$, the intercept on the axis also changes accordingly. The line intercepts the axis at this point no matter what the population growth rate is.

*Graph 3 is shaped like a parabola, starting with small values, increasing to a maximum, then declining to small values again. The position of the maximum is dependent on the values of K and r_d. When r_d is small (around 1), the peak is at $x=K$ and $y=K$. Explore (1) how the peak moves around if you fix one of $K$ or $r_d$ and alter the other parameter and (2) how the slope of the line changes at $N_t=K$. (Hint: the slope of the line changes from positive to negative as $r_d$ increases)*

As mentioned above, the peak of the parabola will be at $K$ on both axes when $r_d$ is small.  You should see that this makes sense because if the population is at carrying capacity in Year 1 (`Nt`, on the x-axis) then next year (Year 2; `Nt+1` on the y-axis) the population size will be the same because with logistic growth the population growth rate is always 0 when the population is at carrying capacity. Therefore, if you change $K$, the peak will move around accordingly, but always will be at $x=K$ and $y=K$.

If you increase $r_d$ above 1, the shape of the relationship between $N_t$ and $N_{t+1}$ remains parabolic, but the location of the peak changes relative to $K$.

*How would the same plots look for regular exponential growth?*

The equivalent plot (for Graph 2) for exponential growth would be a horizontal line - because population growth rate does NOT depend on population size.
```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Deeper into logistic growth",Topic)) %>% select(DTSTART2) %>% pull()}
## Solutions: Deeper into logistic growth

### Relationship between Logistic and Exponential growth equations

The logistic growth equation simplifies to become the exponential growth equation if you set $K$ to be infinite ($\infty$). The simplification goes like this:

1. $\frac{d N}{d t}=r N\left(1-\frac{N}{K}\right)$
2. $\frac{d N}{d t}=r N\left(1-\frac{N}{\infty}\right)$
3. $\frac{d N}{d t}=r N\left(1-0\right)$
4. $\frac{d N}{d t}=r N \times 1$
5. $\frac{d N}{d t}=r N$

This simplification also works with the discrete version of the equation, $N_{t+1}=N_{t}+r_{d} N_{t}\left(1-\frac{N_{t}}{K}\right)$.


### Type of dynamics depends on $r_d$.

As you increase $r_d$, the dynamics of the population changes. At low $r_d$ population size ($N$) simply converges on the carrying capacity, $K$. As $r_d$ you will see damped oscillations whereby $N$ overshoots $K$ and then oscillates and converges to $K$. Then you will see cycles where the population size oscillates *around* $K$. The cycles can be simple two-point cycles (where $N$ bounces between two points), or more complex with $N$ bouncing between four-points (or more). In fact, the critical values of $r_d$ that define the type of dynamics are fixed: if we know $r_d$ we can predict the type of dynamics.

The behaviour of the population dynamics depends only on $r_d$, not on $K$ or starting population size ($N_0$) (as long as $N_0 > K$).

### You can obtain parameters from graphs

You should notice that having some information about what the parameters are will allow you to sketch the dynamics. Conversely, if you have a graph showing aspects of the population dynamics, you could figure out what the parameters of the logistic equation are.

For Exponential growth, populaiton size is unlimited and will grow exponentially if $r$ is $>0$ (or $\lambda > 1$). Logistic growth will show some kind of limit (damped oscillation, or whatver), as the population size is attracted to $K$ in some way.

In logistic growth, the per capita growth rate declines as population size increases, and reaches $0$ when $N = K$. In exponential growth, the per capita growth rate remains constant and unaffected by $N$. Therefore the graphs of growth rate vs. N will be very different: Logistic = a negative slope, expontial = a horizontal line.

### Time lag

Time lagged density dependence results in oscillations. Therefore if we see oscillations in dynamics it could be due to a particular $r_d$ value or lagged density dependence.

### Cobweb diagram

Cobweb diagrams and bifurcation plots offer another way of visualising dynamics of populations (see the article about Chaos, by Mathiopoulos).

Chaotic dynamics are deterministic in the sense that if you have the same initial conditions you will get the same results (dynamics). However, small changes in any parameters ($N_0$, $K$, or $r_d$) will lead to very different dynamics - so in that sense, because of measurement error, the population dynamics would be very hard to predict in practice.
```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Life tables",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Life tables and survivorship types

The take home messages for this exercise are that life tables are a rich source of information on the life history of a population or species. From a simple accounting of ages at death and fertility we can obtain information about the "shape" of the survivorship trajectory: do most deaths happen early or late? Is mortality risk constant with age? We can also calculate measures including **generation time**, $R_0$ and population growth rate. You should know what these measures mean.


You should understand the relationship between mortality risk and survivorship curve. In other words, you should be able to describe, or do a rough sketch of mortality risk with age, if you have a survivorship curve (or vice versa). 

The completed Excel spreadsheet is [here](https://www.dropbox.com/s/j8uv2wf7nz0ygmp/Life%20tables%20exercise%20-%20complete.xlsx?dl=1). 

```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Matrix population modeling",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Matrix population modeling

The main take home messages for this class are that you should: 
(1) understand, and be able to draw or interpret life cycle diagram;
(2) be able to (roughly) parameterise a model shown in the life cycle diagram;
(3) be able to write out a matrix model (the square of numbers) for a given life cycle diagram (and *vice versa*).
(4) understand how population projection works, and to therefore interpret a figure or description showing a population projection.


```

```{asis, echo=today() > icalSchedule %>% filter(grepl("Lotka-Volterra competition",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Lotka-Volterra competition

You can find a completed Excel spreadsheet [here](https://www.dropbox.com/s/q1qoqxhnm82uugw/9.%20LV%20Competition.xlsx?dl=1).

The answers to the questions are [here](https://www.dropbox.com/s/oz2c10bmyf8t7s6/9.%20Answers%20to%20questions.pdf?dl=1).

```


```{asis, echo=today() > icalSchedule %>% filter(grepl("Lotka-Volterra predator-prey dynamics",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Lotka-Volterra predator-prey dynamics

You can find a completed Excel spreadsheet [here](https://www.dropbox.com/s/wet7brtgxywdqi5/10.%20Pred-PreyDynamics.xlsx?dl=1).

The answers to the questions are [here](https://www.dropbox.com/s/mt43nvqu7cjif69/10.%20Answers%20to%20Pred-Prey%20exercise.pdf?dl=1).

```


```{asis, echo=today() > icalSchedule %>% filter(grepl("From population biology to fitness",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: From population biology to fitness

The matrix model with a trade off (increased juvenile survival, but reduced old adult survival) looks like this.

    A3 <- matrix(c(0.00, 5.00, 1.00, 
                   0.11, 0.80, 0.00, 
                   0.00, 0.10, 0.20), 
                byrow = TRUE, nrow = 3)
    
    eigs(A3)$lambda

We can compare the $\lambda$ value from this model to the original one to ask ourselves whether the large cost is worth paying for the small benefit. It turns out that it is. You can then ask how MUCH cost would be worth bearing, by repeating the exercise and slowly reducing old-adult survival until you reach the original $\lambda$ value.

You should find that the cost can be huge, and still worth bearing. In fact, you could reduce old adult survival to 0 and it is still worth doing! You can even reduce old-age adult reproduction without much effect on fitness.

HOWEVER, changes to prime age adults are much more important. You can only reduce survival to about 0.76 (from 0.8) before the cost is not worth bearing (population growth rate falls below that of the first baseline model). 

Thus, old-age costs are "worth it" while prime age costs are much more important. This finding is central to the evolution of senescence and life span, which we will cover later in the course.
```

## Solutions: Bug hunt camouflage

*	_What happens to the average colour of the bug population with time as you hunt?_

The colour evolves to become more similar to the background colour because you (the hunter) find it harder to find these better-camouflaged individuals.

*	_What happens to your hunting efficiency?_

Your hunting efficiency tends to decrease with time because the bugs are evolving to be harder to see. They are evolving camouflaged colours.

*	_Would you say that the bug population becomes worse or better adapted to their environment?_

The population becomes better-adapted to their environment with time.

*	_Can you explain how this happens?_

You (the hunter) kill the most obvious bugs first (i.e. those with contrasting colours to the background). These are the individuals that are not well-adapted to the environment. The survivors have offspring that are similar to them, while the ones you kill leave no offspring. So as time goes on, the population becomes dominated by individuals that are well-camouflaged.

*	_After simulating in one environment (e.g. poppy field) for a few minutes, pause then switch to another environment. Are the bugs now well- or poorly-adapted to their environment?_

Changing the environment means that the individuals are now porrly-adapted to their environment. This is because the individuals now find themselves in an environment that they did not evolve in. Their evolved camouflage does not work so well in a new environment.

*	_Do the genotypes of individuals change (e.g. with individual age)?_

No, individuals' genotypes are fixed. The change in the population occurs because of selection of individuals to reproduce. Better-adapted individuals are more likely to reproduce.

*	_Increasing the “max-mutation-step” makes bug offspring less like their parents. How do you think this will influence the speed of adaptation of the bugs?_

Increasing the amount of variation in offspring will tend to speed up adaptation. However, there are limits: too much variation can cause maladaptation of offspring. For example, if a parent is well-adapted (perfectly camouflaged), too much variation in offspring could lead to some offspring being poorly-camouflaged and therefore vulnerable to predation. 

## Solutions: Neutral or adaptive evolution in humans

The take home message here is that whether traits are adaptive or neutral depends on the environment. 

Consider genes that confer entibiotic resistance on bacteria. In the absence of antibiotics, these genes are not important and are not selected for. They still evolve (if they vary among individuals and are inherited), but this evolution is neutral with no selection. On the other hand, when antibiotics are introduced to the system, those same genes are strongly selected for and evolution of the genes for antibiotic resistance is now strongly adaptive. Context matters.

The same is the case for traits in humans. Assuming the the traits vary among individuals and are inherited, their neutrality or adaptiveness depends on their effect on fitness. If the traits have strong effects on fitness then they will be under strong selection but if they have weak or no effects on fitness they will evolve via neutral evolution.

Example traits that evolve via neutral evolution include fingerprint structure and iris structure. The detailed structures are not important to fitness, but are still genetically determined, and inherited.

Traits like muscle strength, running speed may have been important for fitness when they helped our ancestors obtain food. In those environments, they would have been under selection and therefore evolve via adaptive evolution. In more modern times, these selection pressures are weaker.

```{asis, echo=today() > icalSchedule %>% filter(grepl("Hardy-Weinberg",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Hardy-Weinberg equilibrium

Answers to the Hardy-Weinberg questions.

Remember the basic formulas: 
$p^2 + 2pq + q^2 = 1$ and $p + q = 1$
  
$p$ = frequency of the dominant allele in the population 

$q$ = frequency of the recessive allele in the population

$p^2$ = percentage of homozygous dominant individuals 

$q^2$ = percentage of homozygous recessive individuals 

$2pq$ = percentage of heterozygous individuals 

### Problem 1

The frequency of the *aa* genotype: 36%, as given in the problem itself. 

The frequency of the *a* allele:  The frequency of aa is 36%, which means that $q^2 = 0.36$, by definition. If $q^2 = 0.36$, then $q = 0.6$. Since $q$ equals the frequency of the "a" allele, the frequency is 60%. 

The frequency of the *A* allele: Since $q = 0.6$, and $p + q = 1$, then $p = 0.4$; the frequency of *A* is equal to $p$ (see the basic H-W equations), so the answer is 40%. 

The frequencies of the genotypes *AA* and *Aa*: The frequency of *AA* is equal to $p^2$, and the frequency of *Aa* is equal to $2pq$. So, using the information above, the frequency of *AA* is 16% (i.e. $p^2 = 0.4 x 0.4 = 0.16$ and Aa is 48% ($2pq = 2 \times 0.4 \times 0.6 = 0.48$). 

The frequencies of the two possible phenotypes if *A* is completely dominant over *a*: Because *A* is totally dominate over *a*, the dominant phenotype will show if either the homozygous *AA* or heterozygous *Aa* genotypes occur. The recessive phenotype is controlled by the homozygous *aa* genotype. Therefore, the frequency of the dominant phenotype equals the sum of the frequencies of *AA* and *Aa*, and the recessive phenotype is simply the frequency of *aa*. Therefore, the dominant frequency is 64% and, in the first part of this question above, you have already shown that the recessive frequency is 36%. 

 
### Problem 2

9% = 0.09 = ss = $q^2$. To find $q$, simply take the square root of 0.09 to get 0.3. Since $p = 1 - 0.3$, then $p$ must equal 0.7. $2pq = 2 \times 0.7 \times 0.3 = 0.42$, so 42% of the population are heterozygotes (carriers). 

### Problem 3

The frequency of the recessive allele. Since we believe that the homozygous recessive for this gene ($q^2$) represents 4% (i.e. = 0.04), the square root ($q$) is therefore 0.2 (20%). 

The frequency of the dominant allele.  Since $q = 0.2$, and $p + q = 1$, then $p = 0.8$ (80%). 

The frequency of heterozygous individuals. The frequency of heterozygous individuals is equal to $2pq$. In this case, $2pq = 0.32$, which means that the frequency of individuals heterozygous for this gene is equal to 32% (i.e. $2 \times 0.8 \times 0.2) = 0.32$. 

### Problem 4

The first thing you'll need to do is obtain $p$ and $q$. So, since white is recessive (i.e. *bb*), and 40% of the butterflies are white, then *bb* = $q^2$ = 0.4. 
To determine $q$, which is the frequency of the recessive allele in the population,  take the square root of $q^2$ which is 0.632. So, $q = 0.63$. Since $p + q = 1$, then $p$ must be $1 - 0.63 = 0.37$. 

Now then, to answer our questions. First, what is the percentage of butterflies in the population that are heterozygous? Well, that would be $2pq$ so the answer is $2 \times 0.37\times 0.63 = 0.47$. Second, what is the frequency of homozygous dominant individuals? That would be $p^2$ or $0.37^2 = 0.14$.
```

```{asis, echo=today() > icalSchedule %>% filter(grepl("How many eggs",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: How many eggs should a bird lay?

You can find a completed Excel spreadsheet [here](https://www.dropbox.com/s/tcpxmdfvm35jzgr/How%20many%20eggs%20-%20answers.xlsx?dl=1).

The take-home message is that the trade-off between number of eggs and juvenile survival leads to an optimum number of eggs required to maximise reproductive success (i.e. number of surviving chicks).

You can move this optimum if the trade-off is changed. For example, if you increase survival of the chicks from larger clutches, then the optimum number of eggs will increase.

This fact reminds us that the environment (e.g. predation risk and resource abundance) will be an important factor in determining the evolution of life history parameters (like average number of babies). 

```




```{asis, echo=today() > icalSchedule %>% filter(grepl("force of selection",Topic)) %>% select(DTSTART2) %>% pull()}

## Solutions: Trade-offs and the force of selection

*Simulate this by adding 1 to fertility (mx) in year 1 (the benefit) but reducing survival to 0 (all die) at age 25 (the cost). What is the fitness of this strategy?*
  
Fitness (R0) would be 50.76 (compared to 49.81).

*By setting survival to 0 at other ages, determine how many years of life could be lost before this cost is no longer worth bearing. Is this surprising?*
  
You could “kill” the species at 18, losing 8 years of life, before the new strategy of a small increase in fertility at the expense of years of life at the end of life becomes unfavourable. In other words, a cost of losing 8 yrs of life is worth bearing if the benefit is an extra baby in year 1.


*Now reset everything (mx =10; survival = 0.8). Recall what fitness was when you added 1 to mx at age 1 (R0=50.811). 
If, instead of adding to mx at age 1 you were to increase mx at age 25, how much would you need to increase it to to reach this figure?* 

At age 25 you would need to increase Fertility from 10 to 222 to reach the same level of improvement in fitness as increasing Fertility from 10 to 11 at age 1.

*What about at age 20?*   10 to 80
*Age 15?* 10 to 33
*Age 10?*  10 to 18
*Age 5?* 10 to 13

*What do you notice?*

You should notice that changes made at younger ages have a bigger effect than those at older ages. I have plotted this to the right. The plot shows the amount of increase in fertility that would be required to raise fitness (R0) from 49.81 to >50.81 at ages 1 through to 25 (i.e. the figures you estimated above). You can see that you only need to change fertility a little bit at young ages, but you would need to make BIG changes at older ages. 

*Reset everything again (mx =10; survival = 0.8). Set mx from age 15 onwards to be 0. Now alter survival rate after this point (at ages 15-25). What happens to fitness?*
  
You should notice that any changes you make to survival AFTER reproduction has been completed will have no effect on fitness. In other words evolution “doesn’t care about you” after you have finished with reproduction.
```


## Making a phylogeny

[coming soon]

## Short answer exam discussion

[coming soon]

## The Red Queen game

[coming soon]

<!--chapter:end:3_01.Solutions.Rmd-->

